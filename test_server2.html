<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>RAG API Client Example</title>
</head>
<body>
    <input type="text" id="queryInput" placeholder="쿼리 입력 (e.g., 아이오바이오란 회사에 대해서)">
    <button onclick="sendRequest()">요청 보내기</button>
    <div id="aiResponse" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px;"></div>  <!-- AI 응답만 표시 -->
    <pre id="fullResponse" style="display: none;"></pre>  <!-- 전체 JSON 숨김, 디버깅용 -->

    <script>
        async function sendRequest() {
            const query = document.getElementById('queryInput').value;
            if (!query) {
                alert('쿼리를 입력하세요!');
                return;
            }
            const payload = {
                query: query,
                tool: 'SharedFolderSearchAndRAG',
                file_path: null,
                history: [  // 실제 히스토리 관리: 이전 응답 저장 로직 추가 추천
                    { role: 'user', content: '이전 질문' },
                    { role: 'assistant', content: '이전 응답' }
                ]
            };
            try {
                const response = await fetch('http://localhost:8000/api/rag/query', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                    mode: 'cors'
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                // AI 응답 추출: result에서 [AI] 부분 파싱 (프로답게 정규식 사용)
                const aiMatch = data.result.match(/\[AI\]\n(.*)/s);  // /s로 멀티라인 매치
                const aiText = aiMatch ? aiMatch[1].trim() : data.result;
                document.getElementById('aiResponse').innerHTML = `<strong>AI 응답:</strong> ${aiText.replace(/\n/g, '<br>')}`;
                document.getElementById('fullResponse').textContent = JSON.stringify(data, null, 2);  // 전체 로그
                console.log('Success:', data);
            } catch (error) {
                console.error('Request failed:', error);
                alert('요청 실패: ' + error.message);
            }
        }
    </script>
</body>
</html>